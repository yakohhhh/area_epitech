#!/bin/bash

# Commit-msg hook - Valide le format du message de commit
# Format attendu: type(scope): description
# Types: feat, fix, docs, style, refactor, test, chore

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

print_error() { echo -e "${RED}[✗]${NC} $1"; }
print_status() { echo -e "${GREEN}[✓]${NC} $1"; }

if echo "$COMMIT_MSG" | grep -qE "^(feat|fix|docs|style|refactor|test|chore|build|ci|perf|revert)(\(.+\))?: .+"; then
    print_status "Format de commit valide"
    exit 0
fi

if [ ${#COMMIT_MSG} -lt 10 ]; then
    print_error "Message de commit trop court (minimum 10 caractères)"
    echo ""
    echo "Format recommandé:"
    echo "  feat(scope): Add new feature"
    echo "  fix(scope): Fix bug"
    echo "  docs: Update documentation"
    echo ""
    exit 1
fi

echo -e "${YELLOW}[!]${NC} Format de commit non conventionnel (mais accepté)"
exit 0
